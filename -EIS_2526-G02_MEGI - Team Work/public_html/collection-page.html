<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>

  <!-- App & routing hints (used by JS to build canonical URLs) -->
  <meta name="app-base" content="">
  <meta name="item-page-path" content="index.html"><!-- item page (Index) -->
  <meta name="events-page-path" content="event.html"><!-- events page -->
  <meta name="collection-page-path" content="collection-page.html">
  <meta name="collectors-page-path" content="Homepage.login.html"><!-- Collector page -->
  <meta name="community-page-path" content="Team_page2.html">

  <title>Collection · Star Minis Collection</title>

  <!-- Stylesheet for this page -->
  <link rel="stylesheet" href="css.collection.page/collection-page.css">
</head>
<body>
  <!-- Accessibility: Skip link -->
  <a class="skip-link" href="#main-content">Skip to content</a>

  <div class="layout">
    <!-- Topbar -->
    <header aria-label="Site top bar" class="topbar" role="banner">
      <!-- ✅ Logo clicável SEM trocar tag/classe (não quebra CSS) -->
      <div aria-label="Site name"
           class="topbar__brand"
           role="link"
           tabindex="0"
           style="cursor:pointer"
           onclick="window.location.href='Homepage.login.html';"
           onkeydown="if(event.key==='Enter' || event.key===' '){ event.preventDefault(); window.location.href='Homepage.login.html'; }">
        Collecta<span class="topbar__dot">•</span>Hub
      </div>

      <div class="topbar__actions">
        <button type="button" class="btn btn--ghost" aria-label="Open profile" onclick="window.location.href='profile_page.php';">
          <!-- user icon -->
          <svg aria-hidden="true" class="icon" role="img" viewBox="0 0 24 24"><path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 2c-5.33 0-8 2.67-8 6v1h16v-1c0-3.33-2.67-6-8-6Z"></path></svg>
          <span>Profile</span>
        </button>
          <button
  type="button"
  class="btn btn--ghost"
  aria-label="Logout"
  title="Logout"
  onclick="window.location.href='logout.php';"
>
  <svg aria-hidden="true" class="icon" role="img" viewBox="0 0 24 24">
    <path d="M10 17v-2h4v-6h-4V7l-5 5 5 5Zm9 4H5c-1.1 0-2-.9-2-2V5c0-1.1.9-2 2-2h14c1.1 0 2 .9 2 2v4h-2V5H5v14h14v-4h2v4c0 1.1-.9 2-2 2Z"></path>
  </svg>
  <span>Logout</span>
</button>

      </div>
    </header>

    <!-- Sidebar navigation -->
    <aside aria-label="Primary" class="sidebar">
      <!-- ✅ Create button: controlado por JS local (modal do ZIP).
           IMPORTANTE: removi data-nav="create" pra não deixar o nav.js capturar e tentar usar endpoint errado -->
      <button class="btn btn--primary sidebar__cta"
              id="create-collection"
              type="button">
        <svg aria-hidden="true" class="icon" role="img" viewBox="0 0 24 24"><path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z"></path></svg>
        <span>Create New Collection</span>
      </button>

      <!-- ✅ Navigation list -->
      <nav aria-label="Main navigation" class="sidebar__nav">
        <ul class="sidebar__list">
          <!-- ✅ REMOÇÃO TOTAL: Collector -->
          <li><a class="sidebar__link" data-nav="collector" href="#">Collector</a></li>

          <!-- ✅ REMOÇÃO TOTAL: Collections/Collection -->
          <!-- <li><a class="sidebar__link" data-nav="collections" href="#">Collections</a></li> -->

          <li><a class="sidebar__link" data-nav="events"      href="#">Events</a></li>
          <li><a class="sidebar__link" data-nav="community"   href="#">Community</a></li>
        </ul>
      </nav>
    </aside>

    <!-- Main content -->
    <main aria-label="Collection main content" class="main" id="main-content"
          data-collection-id="12345-star-minis"><!-- collection id used by JS -->

      <!-- Hero -->
      <section aria-label="Collection hero" class="hero">
        <figure class="hero__media">
          <img alt="Star Minis Collection cover image" src="https://picsum.photos/seed/starminis/1200/600"/>
          <figcaption class="sr-only">Cover image of the collection.</figcaption>
        </figure>
        <div class="hero__text">
          <h1 class="hero__title">Star Minis Collection</h1>
          <p class="hero__subtitle">Curate, track, and showcase your miniature stars.</p>
        </div>
      </section>

      <!-- Actions -->
      <section aria-label="Collection actions" class="actions">
        <button aria-label="Add a new item to this collection"
                class="btn btn--secondary btn--lg"
                id="addItemBtn" type="button">
          <!-- add box -->
          <svg aria-hidden="true" class="icon" role="img" viewBox="0 0 24 24"><path d="M19 3H5a2 2 0 0 0-2 2v14l4-4h12a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2ZM13 7v3h3v2h-3v3h-2v-3H8V10h3V7z"></path></svg>
          <span>Add Item</span>
        </button>

        <button id="manageCollectionBtn" aria-label="Manage this collection" class="btn btn--secondary btn--lg" type="button">
          <!-- settings sliders -->
          <svg aria-hidden="true" class="icon" role="img" viewBox="0 0 24 24"><path d="M21 7H10V5h11v2ZM3 7H2V5h1v2Zm6 0H5V5h4v2Zm12 6H14v-2h7v2ZM3 13H2v-2h1v2Zm8 0H5v-2h6v2Zm10 6H9v-2h12v2ZM3 19H2v-2h1v2Zm4 0H5v-2h2v2Z"></path></svg>
          <span>Manage Collection</span>
        </button>
      </section>

      <!-- Filters -->
      <section aria-label="Search and filters" class="filters">
        <div class="field field--search">
          <label class="sr-only" for="search-input">Search items</label>
          <input aria-label="Search items in this collection" id="search-input" inputmode="search" placeholder="Search items" type="search"/>
          <!-- search icon -->
          <svg aria-hidden="true" class="icon icon--left" role="img" viewBox="0 0 24 24"><path d="M10 18a8 8 0 1 1 5.29-14.02A8 8 0 0 1 10 18Zm11 2-6-6"></path></svg>
        </div>
        <div class="field">
          <label class="sr-only" for="filter-select">Filter</label>
          <select aria-label="Filter items" id="filter-select">
            <option value="">Filter</option>
            <option value="type:figure">Type: Figure</option>
            <option value="rarity:high">Rarity: 8–10</option>
            <option value="recent">Recently added</option>
          </select>
        </div>
      </section>

      <!-- Items grid -->
      <section aria-label="Collection items grid" class="grid" data-grid>
        <!-- Card 1 -->
        <article aria-label="Item 1" class="card" data-item-id="item-1" tabindex="0">
          <div class="card__media"
               data-href="index.html?id=item-1&c=12345-star-minis">
            <img alt="Item 1 image" src="https://picsum.photos/seed/item1/400/300"/>
            <span class="badge" title="Rarity 7">R7</span>
          </div>
          <div class="card__body">
            <h3 class="card__title">
              <a aria-label="Open Item 1 details"
                 href="index.html?id=item-1&c=12345-star-minis">Item 1</a>
            </h3>
            <p class="card__meta">Figure · 2019</p>
          </div>
        </article>

        <!-- Card 2 -->
        <article aria-label="Item 2" class="card" data-item-id="item-2" tabindex="0">
          <div class="card__media"
               data-href="index.html?id=item-2&c=12345-star-minis">
            <img alt="Item 2 image" src="https://picsum.photos/seed/item2/400/300"/>
            <span class="badge" title="Rarity 5">R5</span>
          </div>
          <div class="card__body">
            <h3 class="card__title">
              <a aria-label="Open Item 2 details"
                 href="index.html?id=item-2&c=12345-star-minis">Item 2</a>
            </h3>
            <p class="card__meta">Figure · 2020</p>
          </div>
        </article>

        <!-- Card 3 -->
        <article aria-label="Item 3" class="card" data-item-id="item-3" tabindex="0">
          <div class="card__media"
               data-href="index.html?id=item-3&c=12345-star-minis">
            <img alt="Item 3 image" src="https://picsum.photos/seed/item3/400/300"/>
            <span class="badge" title="Rarity 9">R9</span>
          </div>
          <div class="card__body">
            <h3 class="card__title">
              <a aria-label="Open Item 3 details"
                 href="index.html?id=item-3&c=12345-star-minis">Item 3</a>
            </h3>
            <p class="card__meta">Figure · 2018</p>
          </div>
        </article>

        <!-- Card 4 -->
        <article aria-label="Item 4" class="card" data-item-id="item-4" tabindex="0">
          <div class="card__media"
               data-href="index.html?id=item-4&c=12345-star-minis">
            <img alt="Item 4 image" src="https://picsum.photos/seed/item4/400/300"/>
            <span class="badge" title="Rarity 3">R3</span>
          </div>
          <div class="card__body">
            <h3 class="card__title">
              <a aria-label="Open Item 4 details"
                 href="index.html?id=item-4&c=12345-star-minis">Item 4</a>
            </h3>
            <p class="card__meta">Figure · 2022</p>
          </div>
        </article>

        <!-- Card 5 -->
        <article aria-label="Item 5" class="card" data-item-id="item-5" tabindex="0">
          <div class="card__media"
               data-href="index.html?id=item-5&c=12345-star-minis">
            <img alt="Item 5 image" src="https://picsum.photos/seed/item5/400/300"/>
            <span class="badge" title="Rarity 6">R6</span>
          </div>
          <div class="card__body">
            <h3 class="card__title">
              <a aria-label="Open Item 5 details"
                 href="index.html?id=item-5&c=12345-star-minis">Item 5</a>
            </h3>
            <p class="card__meta">Figure · 2021</p>
          </div>
        </article>

        <!-- Card 6 -->
        <article aria-label="Item 6" class="card" data-item-id="item-6" tabindex="0">
          <div class="card__media"
               data-href="index.html?id=item-6&c=12345-star-minis">
            <img alt="Item 6 image" src="https://picsum.photos/seed/item6/400/300"/>
            <span class="badge" title="Rarity 8">R8</span>
          </div>
          <div class="card__body">
            <h3 class="card__title">
              <a aria-label="Open Item 6 details"
                 href="index.html?id=item-6&c=12345-star-minis">Item 6</a>
            </h3>
            <p class="card__meta">Figure · 2017</p>
          </div>
        </article>
      </section>

      <!-- View more -->
      <div class="loadmore">
        <button aria-label="View more items" class="btn btn--secondary btn--block" type="button">View More</button>
      </div>
    </main>

    <!-- Right aside: stats -->
    <aside aria-label="Collection Data" class="stats">
      <h2 class="stats__title">Collection Data</h2>
      <dl class="stats__list">
        <div class="stats__row">
          <dt>Created</dt><dd>Jan 12, 2023</dd>
        </div>
        <div class="stats__row">
          <dt>Type</dt><dd>Miniatures</dd>
        </div>
        <div class="stats__row">
          <dt>Number of Items</dt><dd>128</dd>
        </div>
        <div class="stats__row">
          <dt>Last Record</dt><dd>Oct 02, 2025</dd>
        </div>
      </dl>
    </aside>

    <footer aria-label="Site footer" class="footer">
      <small>© 2025 CollectaHub · <a href="#" rel="nofollow">Privacy</a></small>
    </footer>
  </div>

  <!-- Your collection JS (it will enhance dynamic items and creation flow) -->
  <script src="js.collection.page/collection-page.js?v=3" defer></script>

  <!-- ✅ nav.js por último como você já faz (mantém navegação) -->
  <script src="common/nav.js?v=2" defer></script>

  <script>
    // Mantido: inicialização do seu kit de navegação
    document.addEventListener('DOMContentLoaded', () => {
      const isItemOrEvents = /index\.html|event\.html/i.test(location.pathname);
      window.CollectaNav?.init?.({
        autoBackButton: isItemOrEvents,
        onProfile(el) { console.log('[nav] Profile clicked', el); },
        onConfig(el) { console.log('[nav] Config clicked', el); },
        onCreate(el) { console.log('[nav] Create New Collection clicked', el); }
      });
    });
  </script>

  <!-- ✅ CREATE COLLECTION MODAL (MESMO DO ZIP) + ENDPOINT CORRIGIDO -->
  <script>
    (function () {
      "use strict";

      const qs = (s, el=document) => el.querySelector(s);

      async function fetchText(url, opts = {}) {
        const res = await fetch(url, { credentials: "same-origin", cache: "no-store", ...opts });
        const text = await res.text();
        return { res, text };
      }
      function tryJson(t){ try { return JSON.parse(t); } catch { return null; } }

      async function apiPostForm(url, fd) {
        const { res, text } = await fetchText(url, { method: "POST", body: fd });
        const json = tryJson(text);
        if (!res.ok || !json || json.success !== true) {
          throw new Error((json && (json.error || json.message)) || `HTTP ${res.status}\n\n${text}`);
        }
        return json;
      }

      function ensureCreateCollectionModal() {
        let dlg = qs("#__create_collection_modal");
        if (dlg) return dlg;

        dlg = document.createElement("dialog");
        dlg.id = "__create_collection_modal";
        dlg.setAttribute("aria-label", "Create New Collection");
        Object.assign(dlg.style, {
          width: "min(640px, 92vw)",
          border: "1px solid rgba(0,0,0,.15)",
          borderRadius: "16px",
          padding: "0",
        });

        dlg.innerHTML = `
          <form id="__cc_form" method="dialog" enctype="multipart/form-data" style="padding:18px 18px 16px">
            <h3 style="margin:0 0 14px">Create New Collection</h3>

            <div style="display:grid; gap:10px">
              <label style="display:grid; gap:6px">
                <span style="font-weight:600">Name *</span>
                <input id="__cc_name" name="name" required type="text"
                       style="padding:10px;border:1px solid #ddd;border-radius:10px">
              </label>

              <label style="display:grid; gap:6px">
                <span style="font-weight:600">Type</span>
                <input id="__cc_type" name="type" type="text" placeholder="Miniatures, Cards..."
                       style="padding:10px;border:1px solid #ddd;border-radius:10px">
              </label>

              <label style="display:grid; gap:6px">
                <span style="font-weight:600">Creation date</span>
                <input id="__cc_date" name="creation_date" type="date"
                       style="padding:10px;border:1px solid #ddd;border-radius:10px">
              </label>

              <label style="display:grid; gap:6px">
                <span style="font-weight:600">Description</span>
                <textarea id="__cc_desc" name="description" rows="3"
                          style="padding:10px;border:1px solid #ddd;border-radius:10px;resize:vertical"></textarea>
              </label>

              <label style="display:grid; gap:6px">
                <span style="font-weight:600">Banner image (optional)</span>
                <input id="__cc_image" name="image" type="file" accept="image/*"
                       style="padding:10px;border:1px solid #ddd;border-radius:10px;background:#fff">
              </label>

              <div id="__cc_preview_wrap" style="display:none;margin-top:4px">
                <img id="__cc_preview" alt="Preview"
                     style="width:100%;max-height:220px;object-fit:cover;border-radius:12px;border:1px solid #ddd">
              </div>

              <p id="__cc_error" style="margin:6px 0 0;color:#B00020;font-weight:600"></p>
            </div>

            <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:14px">
              <button type="button" id="__cc_cancel"
                      style="padding:10px 14px;border-radius:10px;border:1px solid #ddd;background:#fff;cursor:pointer">
                Cancel
              </button>
              <button type="submit" id="__cc_save"
                      style="padding:10px 14px;border-radius:10px;border:0;background:#111;color:#fff;cursor:pointer">
                Create
              </button>
            </div>
          </form>
        `;

        document.body.appendChild(dlg);

        // default date
        const dateInput = qs("#__cc_date", dlg);
        if (dateInput && !dateInput.value) dateInput.value = new Date().toISOString().slice(0, 10);

        // preview
        const file = qs("#__cc_image", dlg);
        const prevWrap = qs("#__cc_preview_wrap", dlg);
        const prevImg = qs("#__cc_preview", dlg);

        file.addEventListener("change", () => {
          const f = file.files && file.files[0];
          if (!f) {
            prevWrap.style.display = "none";
            prevImg.removeAttribute("src");
            return;
          }
          prevImg.src = URL.createObjectURL(f);
          prevWrap.style.display = "block";
        });

        qs("#__cc_cancel", dlg).addEventListener("click", () => dlg.close());

        return dlg;
      }

      async function createCollectionFromModal() {
        const dlg = ensureCreateCollectionModal();
        const errEl = qs("#__cc_error", dlg);
        errEl.textContent = "";

        const name = (qs("#__cc_name", dlg).value || "").trim();
        const type = (qs("#__cc_type", dlg).value || "").trim();
        const date = (qs("#__cc_date", dlg).value || "").trim();
        const desc = (qs("#__cc_desc", dlg).value || "").trim();

        if (!name) {
          errEl.textContent = "Name is required.";
          return;
        }

        try {
          const fd = new FormData();
          fd.append("action", "create");
          fd.append("name", name);
          fd.append("type", type);
          fd.append("creation_date", date || new Date().toISOString().slice(0, 10));
          fd.append("description", desc);

          const img = qs("#__cc_image", dlg);
          if (img && img.files && img.files[0]) fd.append("image", img.files[0]);

          // ✅ endpoint correto do seu projeto
          const json = await apiPostForm("collections_api.php", fd);

          const created = json.collection || json;
          const newId = created.collection_id ?? json.collection_id ?? created.id ?? null;

          if (!newId) throw new Error("API did not return collection_id.");

          dlg.close();

          // redireciona pra nova collection
          window.location.href = "collection-page.html?id=" + encodeURIComponent(newId);
        } catch (e) {
          console.error(e);
          errEl.textContent = String(e.message || e);
        }
      }

      function openCreateCollectionModal() {
        const dlg = ensureCreateCollectionModal();
        const form = qs("#__cc_form", dlg);

        if (!form.dataset.bound) {
          form.dataset.bound = "1";
          form.addEventListener("submit", async (e) => {
            e.preventDefault();
            await createCollectionFromModal();
          });
        }

        dlg.showModal();
      }

      document.addEventListener("DOMContentLoaded", () => {
        const btn = document.getElementById("create-collection");
        if (!btn) return;
        btn.addEventListener("click", (e) => {
          e.preventDefault();
          openCreateCollectionModal();
        });
      });
    })();
  </script>

  <!-- Mantive o seu bloco grande de patch de upload/eventos INTACTO (mínima alteração) -->
  <script>
  (() => {
    "use strict";

    const qs = (s, el=document) => el.querySelector(s);
    const qsa = (s, el=document) => Array.from(el.querySelectorAll(s));
    const getMeta = (name, fallback="") =>
      (document.querySelector(\`meta[name="\${name}"]\`)?.getAttribute("content") ?? fallback).toString();

    const APP_BASE = getMeta("app-base", "").replace(/\/+$/, "");
    const EVENTS_PAGE_PATH = getMeta("events-page-path", "event.html").replace(/^\/+/, "");
    const withBase = (p) => (APP_BASE ? \`\${APP_BASE}/\` : "") + p;

    function getCollectionId() {
      const main = qs("#main-content");
      const urlParams = new URLSearchParams(location.search);
      return urlParams.get("id") || main?.dataset?.collectionId || "demo-collection";
    }

    function buildEventsUrl() {
      const cid = getCollectionId();
      return withBase(\`\${EVENTS_PAGE_PATH}?c=\${encodeURIComponent(cid)}\`);
    }

    function toast(msg, type="info") {
      let root = qs("#__patch_toast");
      if (!root) {
        root = document.createElement("div");
        root.id = "__patch_toast";
        Object.assign(root.style, {
          position:"fixed", right:"16px", bottom:"16px", zIndex: 100000,
          display:"flex", flexDirection:"column", gap:"8px"
        });
        document.body.appendChild(root);
      }
      const el = document.createElement("div");
      el.textContent = msg;
      Object.assign(el.style, {
        background: type==="error" ? "#B00020" : type==="success" ? "#0B8A83" : "#333",
        color:"#fff", padding:"10px 14px", borderRadius:"10px",
        boxShadow:"0 8px 24px rgba(0,0,0,.2)", fontSize:"14px", maxWidth:"340px"
      });
      root.appendChild(el);
      setTimeout(() => {
        el.style.opacity="0"; el.style.transform="translateY(6px)"; el.style.transition="all .25s ease";
        setTimeout(() => el.remove(), 250);
      }, 2200);
    }

    const UPLOAD_MARK = "data-event-upload-patched";

    function findCreateEventForm() {
      const dialogs = qsa('[role="dialog"][aria-modal="true"]');
      for (const d of dialogs) {
        const h2 = qsa("h2", d).find(x => (x.textContent || "").trim().toLowerCase() === "create event");
        if (!h2) continue;
        const form = qs("form", d);
        if (form) return form;
      }
      return null;
    }

    function injectUploadUI(form) {
      if (!form || form.getAttribute(UPLOAD_MARK) === "1") return;

      const textarea = qs('textarea[name="description"]', form) || qs("textarea", form);
      const holder = document.createElement("div");
      holder.className = "event-upload";
      holder.innerHTML = `
        <div style="margin:8px 0 12px">
          <label for="__event_image_input" style="display:block;font-weight:600;margin-bottom:6px">
            Event image (optional)
          </label>

          <input
            id="__event_image_input"
            name="image"
            type="file"
            accept="image/*"
            style="display:block !important; width:100% !important; padding:10px !important;
                   border:1px solid #ddd !important; border-radius:10px !important;
                   background:#fff !important; opacity:1 !important; visibility:visible !important;
                   position:static !important; pointer-events:auto !important;"
          />

          <div id="__event_image_preview_wrap" style="margin-top:10px;display:none">
            <img
              id="__event_image_preview"
              alt="Preview"
              style="width:100%;max-height:220px;object-fit:cover;border-radius:12px;border:1px solid #ddd;display:block"
            />
          </div>

          <small style="display:block;margin-top:6px;opacity:.75">
            Upload an image from your computer (JPG/PNG/WebP).
          </small>
        </div>
      `;

      if (textarea && textarea.parentNode) {
        textarea.parentNode.insertBefore(holder, textarea);
      } else {
        form.appendChild(holder);
      }

      const input = qs("#__event_image_input", form);
      const prevWrap = qs("#__event_image_preview_wrap", form);
      const prevImg = qs("#__event_image_preview", form);

      input.addEventListener("change", () => {
        const file = input.files && input.files[0];
        if (!file) {
          prevWrap.style.display = "none";
          prevImg.removeAttribute("src");
          return;
        }
        prevImg.src = URL.createObjectURL(file);
        prevWrap.style.display = "block";
      });

      form.setAttribute(UPLOAD_MARK, "1");
    }

    function attachSubmitOverride(form) {
      if (!form || form.dataset.submitPatched === "1") return;
      form.dataset.submitPatched = "1";

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        e.stopImmediatePropagation();

        const cid = getCollectionId();

        const name = (qs('input[name="name"]', form)?.value || "").trim();
        const location = (qs('input[name="location"]', form)?.value || "").trim();
        const date = (qs('input[name="date"]', form)?.value || "").trim();
        const description = (qs('textarea[name="description"]', form)?.value || "").trim();

        if (!name || !location || !date) {
          toast("Fill in Event name, Location and Date.", "error");
          return;
        }

        try {
          const fd = new FormData();
          fd.append("action", "create");
          fd.append("collection", cid);
          fd.append("name", name);
          fd.append("location", location);
          fd.append("date", date);
          fd.append("description", description || \`Event related to collection "\${cid}".\`);

          const fileInput = qs("#__event_image_input", form) || qs('input[type="file"][name="image"]', form);
          if (fileInput && fileInput.files && fileInput.files[0]) {
            fd.append("image", fileInput.files[0]);
          }

          const res = await fetch("events_api.php", { method: "POST", body: fd });
          const json = await res.json().catch(() => ({}));

          if (!res.ok || !json.success) {
            throw new Error(json.error || "Could not create event.");
          }

          toast("Event created.", "success");
          location.href = buildEventsUrl();
        } catch (err) {
          console.error(err);
          toast("Could not create event.", "error");
        }
      }, true);
    }

    function patchIfNeeded() {
      const form = findCreateEventForm();
      if (!form) return;
      injectUploadUI(form);
      attachSubmitOverride(form);
    }

    patchIfNeeded();
    const mo = new MutationObserver(() => patchIfNeeded());
    mo.observe(document.body, { childList: true, subtree: true });

  })();
  </script>

</body>
</html>
